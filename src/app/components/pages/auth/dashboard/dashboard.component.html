<main>
    <div class="container">
        <div class="transactionsContainer">
            <div class="transactionsHeader">
                <h1 class="font-heading">Transações</h1>
            </div>
            <div class="lastTransactionsContainer">
                <span>Últimas transações</span>
                <div class="transactionsTableContainer">
                    <span *ngIf="isTableLoading == true">Carregando...</span>
                    <span
                        *ngIf="
                            transactions.length == 0 && isTableLoading == false
                        "
                        >Ainda não há registros!</span
                    >
                    <table
                        class="transactionsTable"
                        *ngIf="transactions.length > 0"
                    >
                        <tr class="tableHeadersContainer">
                            <th>#</th>
                            <th>Data</th>
                            <th>Valor</th>
                            <th>Categoria</th>
                            <th>Destinatário</th>
                            <th>Alterar</th>
                            <th>Deletar</th>
                        </tr>
                        <tr
                            class="tableRow"
                            *ngFor="let transaction of transactions"
                        >
                            <th>{{ transaction.id }}</th>
                            <td>{{ transaction.date }}</td>
                            <td>{{ transaction.value?.toFixed(2) }}</td>
                            <td>{{ transaction.category?.name }}</td>
                            <td>{{ transaction.recipient?.name }}</td>
                            <td>
                                <button
                                    (click)="onClickUpdate(transaction)"
                                    class="updateButton"
                                >
                                    Alterar
                                </button>
                            </td>
                            <td>
                                <button
                                    (click)="onClickDelete(transaction)"
                                    class="deleteButton"
                                >
                                    Deletar
                                </button>
                            </td>
                        </tr>
                    </table>

                    <div
                        class="newItemButtonContainer"
                        *ngIf="isTableLoading == false"
                    >
                        <button (click)="onClickNew()">+ Nova transação</button>
                        <button (click)="onClickLargeScale()">
                            + Novas transações (em massa)
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="entitiesContainer">
            <span>Outras entidades</span>
            <button routerLink="/auth/categories">Categorias</button>
            <button routerLink="/auth/recipients">Destinatários</button>
        </div>
    </div>
</main>

<app-modal
    (closeModal)="receiveCloseModal($event)"
    modalId="actionModal"
    *ngIf="currentModal != null"
>
    <!--Criar-->
    <div class="modalContainer" *ngIf="currentModal.action == 'save'">
        <div class="modalTitle">
            <h2>Nova transação</h2>
        </div>
        <div class="inputsContainer">
            <div class="inputContainer">
                <label for="">Valor da transação</label>
                <input [(ngModel)]="currentModal.data.value" type="number" />
            </div>
            <div class="inputContainer">
                <label for="">Categoria</label>
                <select [(ngModel)]="currentModal.data.category_id">
                    <option
                        *ngFor="let category of categories"
                        [selected]="
                            category.id == currentModal.data.category_id
                        "
                        [value]="category.id"
                    >
                        {{ category.name }}
                    </option>
                </select>
            </div>
            <div class="inputContainer">
                <label for="">Destinatário</label>
                <select [(ngModel)]="currentModal.data.recipient_id">
                    <option
                        *ngFor="let recipient of recipients"
                        [selected]="
                            recipient.id == currentModal.data.recipient_id
                        "
                        [value]="recipient.id"
                    >
                        {{ recipient.name }}
                    </option>
                </select>
            </div>
            <div class="inputContainer">
                <label for="">Data</label>
                <input
                    [(ngModel)]="currentModal.data.date"
                    type="date"
                    [value]="currentModal.data.date"
                />
            </div>
        </div>

        <button
            [disabled]="isModalLoading"
            (click)="onClickModalSave()"
            class="modalSubmit"
        >
            Salvar
        </button>
    </div>

    <!--Criar em massa-->
    <div
        class="modalContainer largeScale"
        *ngIf="currentModal.action == 'largeScaleSave'"
    >
        <div class="modalTitle">
            <h2>Nova transação</h2>
        </div>
        <div class="inputsContainer">
            <div class="inputContainer">
                <label for="">Transações em massa</label>
                <textarea
                    [(ngModel)]="currentModal.data.content"
                    type="number"
                ></textarea>
            </div>
            <span class="modalWarning"
                >Atenção: Não deixe espaços em branco</span
            >
        </div>

        <button
            [disabled]="isModalLoading"
            (click)="onClickModalLargeScaleSave()"
            class="modalSubmit"
        >
            Salvar
        </button>
    </div>

    <!--Alterar-->
    <div class="modalContainer" *ngIf="currentModal.action == 'update'">
        <div class="modalTitle">
            <h2>Atualizar</h2>
            <span>#{{ currentModal.data.id }}</span>
        </div>
        <div class="inputsContainer">
            <div class="inputContainer">
                <label for="">Valor da transação</label>
                <input [(ngModel)]="currentModal.data.value" type="number" />
            </div>
            <div class="inputContainer">
                <label for="">Categoria</label>
                <select [(ngModel)]="currentModal.data.category_id">
                    <option
                        *ngFor="let category of categories"
                        [selected]="
                            category.id == currentModal.data.category_id
                        "
                        [value]="category.id"
                    >
                        {{ category.name }}
                    </option>
                </select>
            </div>
            <div class="inputContainer">
                <label for="">Destinatário</label>
                <select [(ngModel)]="currentModal.data.recipient_id">
                    <option
                        *ngFor="let recipient of recipients"
                        [selected]="
                            recipient.id == currentModal.data.recipient_id
                        "
                        [value]="recipient.id"
                    >
                        {{ recipient.name }}
                    </option>
                </select>
            </div>
            <div class="inputContainer">
                <label for="">Data</label>
                <input [(ngModel)]="currentModal.data.date" type="date" />
            </div>
        </div>

        <button
            [disabled]="isModalLoading"
            (click)="onClickModalUpdate()"
            class="modalSubmit"
        >
            Atualizar
        </button>
    </div>

    <!--Deletar-->
    <div class="modalContainer" *ngIf="currentModal.action == 'delete'">
        <h2>Deletar</h2>
        <div class="confirmationContainer">
            <span
                >Tem certeza que deseja deletar a transação #{{
                    currentModal.data.id
                }}?</span
            >
            <div class="confirmationInfo">
                <span
                    ><b>Valor: </b>
                    {{ currentModal.data.value?.toFixed(2) }}</span
                >
                <span
                    ><b>Categoria: </b
                    >{{ currentModal.data.category.name }}</span
                >
                <span
                    ><b>Destinatário: </b
                    >{{ currentModal.data.recipient.name }}</span
                >
            </div>
        </div>

        <button
            [disabled]="isModalLoading"
            (click)="onClickModalDelete()"
            class="modalSubmit"
        >
            Deletar
        </button>
    </div>
</app-modal>
